---
title: "Gov51 - PSET1"
author: "Steffny Meegoda"
url: https://github.com/Steffny2004/gov51-ps1
format: pdf
editor: visual
---
```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(
  options(scipen = 999), 
	echo = TRUE,
	eval = TRUE,
	message = FALSE,
	warning = FALSE
)
```

# 2 Get to Know Your Data

## 2.1 Load ACS data
```{r}
#2.1 Load data
library(tidyverse)
acs2024_raw <- read.csv("data/raw/acs2024.csv")
```

## 2.2 What does each variable mean?
From the IPUMS variable descriptions, the following variables mean:

* `YEAR` - Reports the year when the household was included in the ACS.
* `SAMPLE` - Unique 6-digit code that identifies the IPUMS sample. 
  * First 4 digits are the year of the census/survey.
  * Last 2 digits identify the sample within the year.
* `SERIAL` - Unique 8-digit code assigned to each household record in a given sample.
* `HHWT` - Indicates how many households in the U.S. population are represented by a given household in an IPUMS sample and has two implied decimals
* `CLUSTER` - An 11-digit numeric variable designed for use with STRATA in Taylor series linear approximation for correction of complex sample design characteristics.
* `STATEFIP` - Reports the state in which the household was located.
* `GQ` - Classifies housing units as either households, group quarters, or vacant units.
* `PERNUM` - Numbers all persons within each household consecutively in the order in which they appear on the original census or survey form.
* `PERWT` - Indicates how many persons in the U.S. population are represented by a given person in an IPUMS sample and has two implied decimals.
* `SEX` - Reports if the person was male or female.
* `AGE` - Reports the person's age in years as of the last birthday.
* `EDUC` - Indicates respondents' highest year of school or degree completed.
* `EDUCD` - Same as `EDUC`, but with a more detailed coding scheme.
* `EMPSTAT` - Indicates if respondent was employed, unemployed, or not in labor force.
* `EMPSTATD` - Same as `EMPSTATD`, but with a more detailed coding scheme.
* `INCTOT` - Reports respondent's total pre-tax personal income or losses from all sources for the previous year.
* `TRANTIME` - Reports the total amount of time, in minutes, that it usually took the respondent to get from home to work last week.

```{r, include=FALSE}
#Exploratory Analysis to answer Q2.3
sum(is.na(acs2024_raw$EDUC))
table(acs2024_raw$EDUC)

sum(is.na(acs2024_raw$EMPSTAT))
table(acs2024_raw$EMPSTAT)

sum(is.na(acs2024_raw$TRANTIME))
table(acs2024_raw$TRANTIME)
```

## 2.3 Create new variables
```{r}
#2.3 Create new variables
acs2024_clean <- acs2024_raw %>% 
  
  # Indicator female var from SEX
  mutate(female = if_else(SEX == 2, 1, 0)) %>%
  
  # Indicator dummy vars from EDUC  
  mutate(less_than_hs = ifelse(EDUC <= 5 | EDUC == 99, 1, 0)) %>%
  mutate(hs_only = ifelse(EDUC == 6, 1, 0)) %>%
  mutate(some_college = ifelse(EDUC >= 7 & EDUC <= 9 , 1, 0)) %>%
  mutate(college_only = ifelse(EDUC == 10, 1, 0)) %>%
  mutate(advanced_degree = ifelse(EDUC == 11, 1, 0)) %>%
  
  # Indicator dummy vars from EDUC
  mutate(employed = ifelse(EMPSTAT == 1, 1, 0)) %>%
  mutate(unemployed = ifelse(EMPSTAT == 2, 1, 0)) %>%
  mutate(not_in_labor_force = ifelse(EMPSTAT == 3, 1, 0))

# List of dummy indicator vars
dummy_vars <- c("female", 
                "less_than_hs", "hs_only", "some_college", "college_only", "advanced_degree",
                "employed", "unemployed", "not_in_labor_force")
```

## 2.4  Why do special codes (0 or 99 for "N/A" or "Unknown") matter?
If you treated "N/A" codes as real zeroes when calculating summary statistics, this would affect numeric calculations such as the mean and median. For instance, `TRANTIME` has no rows that contain "N/A" outright, which could falsely lead us to conclude that there are no such "N/A" values in our data. However, `TRANTIME` has coded "N/A"'s as 0, so when we fail to exclude the "N/A" observations that are coded as 0, of which there are 2062945 observations, then the mean commute time is 10.81 minutes and the median is 0 minutes. These values are drastically lower than when we do exclude the "N/A"'s, which then gives us a mean commute time of 27.2 minutes and a median of 20 minutes.

```{r, echo=FALSE}
# N/A observations included
mean_trantime <- mean(acs2024_clean$TRANTIME)
median_trantime <- median(acs2024_clean$TRANTIME)

# N/A observations excluded
mean_trantime_no_na <- mean(acs2024_clean$TRANTIME[acs2024_clean$TRANTIME != 0])
median_trantime_no_na <- median(acs2024_clean$TRANTIME[acs2024_clean$TRANTIME != 0])

# Print values
#cat("N/A's included for Commute Time:\n", "Mean:", mean_trantime, "\n Median:", median_trantime)
#cat("\nN/A's excluded for Commute Time:\n", "Mean:", mean_trantime_no_na, "\n Median:", median_trantime_no_na)
```

## 2.5 Create a summary statistics table
```{r}
# Summary stats
summary_stats <- acs2024_clean %>%
  
  # Select cols for summary stats
  select(AGE, 
         female, 
         less_than_hs, hs_only, some_college, college_only, advanced_degree, 
         employed, unemployed, not_in_labor_force, 
         TRANTIME, 
         INCTOT) %>%
  
  # Exclude "N/A" coded observations
  mutate(
    TRANTIME = na_if(TRANTIME, 0), 
    INCTOT = na_if(INCTOT, 9999999)) %>%
  
  # Calculate summary stats
  pivot_longer(everything(), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  summarize(
    N = sum(!is.na(value)), 
    Mean = round(mean(value, na.rm = TRUE), 2), 
    `Std Dev` = round(sd(value, na.rm = TRUE), 2),
    Min = min(value, na.rm = TRUE),
    Max = max(value, na.rm = TRUE),
    .groups = "drop"
  )

# Make var labels for rendered table
var_labels <- data.frame(
  variable = c(
    "AGE","female","less_than_hs","hs_only","some_college",
    "college_only","advanced_degree",
    "employed","unemployed","not_in_labor_force",
    "TRANTIME","INCTOT"
  ),
  label = c(
    "Age",
    "Female",
    "Less than High School",
    "High School Only",
    "Some College",
    "College Only",
    "Advanced Degree",
    "Employed",
    "Unemployed",
    "Not in Labor Force",
    "Commute Time (minutes)",
    "Total Income ($)"
  ),
  stringsAsFactors = FALSE
)

# Make rendered summary stats table
library(kableExtra)

summary_stats_rendered <- summary_stats %>%
  left_join(var_labels, by = "variable") %>%
  mutate(variable = label) %>%
  select(-label) %>%
  kable(
    caption = "Summary Statistics for 2024 ACS Sample",
    col.names = c("Variable", "N", "Mean", "Std Dev", "Min", "Max"),
    align = c("l", "r", "r", "r", "r", "r")) %>%
  kable_styling(latex_options = "hold_position")

# Display rendered table
summary_stats_rendered
```

## 2.6 Does the max commute time make sense for a daily commute?
The maximum reported commute time from our data is 195 minutes, and interestingly, all individuals who reported a 195 minute commute are from Wyoming. This seems like an absurdly long commute time, but when we look at the description of the `TRANTIME` variable, it states that this this variable is reporting the total amount of time, in minutes, that it usually took the respondent to get from home to work last week, so it might be that the reported 195 minutes is an aggregated commute time over 1 week rather than representing a daily commute.


# 3 Who Should Be in Your Analysis?

## 3.1 Investigate the data
```{r}
no_commute_count <- sum(acs2024_clean$TRANTIME == 0)
no_commute_perc <- no_commute_count / nrow(acs2024_clean) * 100

cat("There are", no_commute_count, "people who had an 'N/A' commute time, or equivalently,", round(no_commute_perc, 1), "% of the sample had an 'N/A' commute time.")
```
```{r}
# Susbet of non-commuters
non_commuters <- acs2024_clean %>%
  filter(TRANTIME == 0) 

# Non-commuter employment status
non_commuters_empstat <- non_commuters %>%
  summarize(
    employed_perc = mean(employed == 1, na.rm = TRUE) * 100,
    unemployed_perc = mean(unemployed == 1, na.rm = TRUE) * 100,
    not_in_labor_force_perc = mean(not_in_labor_force == 1, na.rm = TRUE) * 100
  )
non_commuters_empstat

# Non-commuter age 
ggplot(non_commuters, aes(x = AGE)) +
  geom_histogram(fill = "lightblue", color = "skyblue") + 
  labs(title = "Age Distribution of Non-Commuters", x = "Age", y = "Count") + 
  theme_minimal()
```
From this very simple analysis on the sample of people that had an "N/A" commute time who we will dub "non-commuters", we see that the majority of these individuals (58%) are not in the labor force, and the bulk distribution of these individuals are on either end of the age spectrum, namely children under 18 years old and adults over 65 years old.

## 3.2 Make your decision
```{r}
commuters <- acs2024_clean %>%
  filter(TRANTIME != 0 & employed == 1)
```

To be included in the `commuters` susbset, I decided to only focus on people who had a commute time that wasn't coded as being "N/A", and who were also employed. This would ensure that we could study commute times for people who actually commute to work rather than accidentally including remote workers (who are employed but have no commute), or people with no commute at all (who are coded with '0' for `TRANTIME`).

## 3.3 Verify your subset
```{r}
commuter_count <- nrow(commuters)
min_commute <- min(commuters$TRANTIME)

cat("Now, our analytical sample has", commuter_count, "people and a minimum commute time of", min_commute, "minute, which makes sense since there are individuals who likely live on the same street as their work.")
```

## 3.4 Create a new summary statistics table
```{r}
# Summary stats
commuters_summary <- commuters %>%
  
  # Select cols for summary stats
  select(AGE, 
         female, 
         less_than_hs, hs_only, some_college, college_only, advanced_degree, 
         employed, unemployed, not_in_labor_force, 
         TRANTIME, 
         INCTOT) %>%
  
  # Exclude "N/A" coded observations
  mutate(
    TRANTIME = na_if(TRANTIME, 0), 
    INCTOT = na_if(INCTOT, 9999999)) %>%
  
  # Calculate summary stats
  pivot_longer(everything(), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  summarize(
    N = sum(!is.na(value)),
    Mean = round(mean(value, na.rm = TRUE), 2),
    `Std Dev` = round(sd(value, na.rm = TRUE), 2),
    Min = min(value, na.rm = TRUE),
    Max = max(value, na.rm = TRUE),
    .groups = "drop"
  )

# Create Rendered Summary Stats
commuters_summary_rendered <- commuters_summary %>%
  left_join(var_labels, by = "variable") %>%
  mutate(variable = label) %>%
  select(-label) %>%
  kable(
    caption = "Summary Statistics for Commuter Subset of 2024 ACS Sample",
    col.names = c("Variable", "N", "Mean", "Std Dev", "Min", "Max"),
    align = c("l", "r", "r", "r", "r", "r")) %>%
  kable_styling(latex_options = "hold_position")

# Display rendered table
commuters_summary_rendered
```


# 4 Visualize and Interpret

## 4.1 Create a histogram of commute times
```{r}
commute_histogram <- ggplot(commuters, aes(x = TRANTIME)) +
  geom_histogram(binwidth = 10, fill = "lightblue", color = "skyblue") + 
  labs(title = "Commute Times for Commuter Subset of 2024 ACS Sample ", 
       x = "Commute Times (minutes)", 
       y = "Count") + 
  theme_minimal()

commute_histogram
```

## 4.2 Describe what you see
From the histogram, it appears that the distribution of commute times is heavily right-skewed by a few, but extremely high, commute times that makes the histogram asymmetric However, the bulk of the data shows commuters traveling to work in under 50 minutes, with the center being around 20 minutes.

## 4.3 Compare the mean and median commute time
From the summary statistics table, the mean commute time was 27.2 minutes, which is higher than the median commute time that appears to be around 20 minutes. This agrees with our visual because the histogram is right-skewed by the more extreme commute times, which pulls the mean up despite the majority of commute times not being nearly as high.

## 4.4 Save your histogram
```{r}
ggsave(filename = "output/commute_histogram.png", plot = commute_histogram)
```


# 5 The Weight of Evidence

## 5.1 Calculate the weighted mean
```{r}
weighted.mean(commuters$TRANTIME, commuters$PERWT)
```

## 5.2 Compare the means
The weighted mean commute time, 27.19 minutes, is only 0.03 minutes less than the unweighted mean commute time of 27.22 minutes that we found earlier, making them very similar.

## 5.3 What does each mean represent and why might they differ?
The unweighted mean commute time represents the average commute time across individuals in the sample, with each individual having an equal weight. The weighted mean commute time, however, weights the individual observations in the sample by its person weight (`PERWT`) to adjust the mean commute time such that it represents the actual population that the sample was taken from, which in this case would be the U.S. population. The unweighted and weighted means might differ if the commuter sample was not an accurate representation of the U.S. population due to an over-sampling or under-sampling of certain groups.